---
title: "Goã§GitHubã¸pushã™ã‚‹å‰ã«makeã‚³ãƒãƒ³ãƒ‰ã§precommitã™ã‚‹æ–¹æ³•"
emoji: "ğŸ§¹"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["go"]
published: true
---


### ã¯ã˜ã‚ã«
å¹³ä¸‹CTO@sweeepã§ã™ã€‚Goè¨€èªã§GitHubãªã©ã¸pushã™ã‚‹å‰ã«makeã‚³ãƒãƒ³ãƒ‰ã§precommitã‚’ã™ã‚‹æ–¹æ³•ã‚’ã“ã¡ã‚‰ã‚’ã‚µãƒ³ãƒ—ãƒ«ã«è§£èª¬ã—ã¾ã™ã€‚â†’ [Goã§ãƒ•ã‚¡ã‚¤ãƒ«ã®Validationæ–¹æ³•ãªã©](https://zenn.dev/hirac/articles/dc537f0786cae9)

æœ¬è¨˜äº‹ã®å†…å®¹ã§ã™ã€‚
* precommitã®å†…å®¹
* makeã‚³ãƒãƒ³ãƒ‰ã§precommitä¸€æ‹¬å®Ÿè¡Œ
* å®Ÿè¡Œçµæœ
* PRæ™‚ã®precommit checkãƒªã‚¹ãƒˆ

### precommitã®å†…å®¹
precommitæ™‚ã®ãã‚Œãã‚Œã®æ•´å½¢/linter/ãƒã‚§ãƒƒã‚¯ã«ã¤ã„ã¦ä»¥ä¸‹è¨˜ã—ã¾ã™ã€‚

* goimports: Goè¨€èªã®æ¨™æº–ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚’æ•´å½¢ã—ã€ã¾ãŸã€gofmtã®ãƒ«ãƒ¼ãƒ«ã§ã‚³ãƒ¼ãƒ‰ã‚’æ•´å½¢ã—ã¾ã™ã€‚
```
$ find . -print | grep --regex '.*\.go' | xargs goimports -w -local "github.com/hirac1220/go-file/utils"
```

* fmt: Goè¨€èªã®æ¨™æº–ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§ã‚³ãƒ¼ãƒ‰ã‚’æ•´å½¢ã—ã¾ã™ã€‚
```
$ go fmt ./...
```

* vet: Goè¨€èªæ¨™æº–ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§é™çš„è§£æã—ã¾ã™ã€‚
```
$ go vet ./...
```

* errcheck: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã•ã‚Œã¦ã„ãªã„ã‚¨ãƒ©ãƒ¼ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¾ã™ã€‚
```
$ errcheck
```

https://github.com/kisielk/errcheck

* staticcheck: ã“ã¡ã‚‰ã‚‚Goè¨€èªã‚’é™çš„è§£æã—ã¾ã™ã€‚
```
$ staticcheck ./...
```

https://staticcheck.io/docs/getting-started/

* gosec: ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ã‚¹ã‚­ãƒ£ãƒ³ã—ã¦ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®å•é¡Œã«ã¤ã„ã¦ãƒã‚§ãƒƒã‚¯ã—ã¾ã™ã€‚
```
$ gosec ./...
```

https://github.com/securego/gosec

* golangci-lint: Goè¨€èªã®å¤šãã®linterã‚’æ­è¼‰ã—ã¦ã„ã¾ã™ã€‚ã“ã¡ã‚‰ã§ä»–ã®linterã¾ã‹ãªã†ã“ã¨ã‚‚ã€‚
```
$ golangci-lint run ./...
```

https://github.com/golangci/golangci-lint

* ãã‚Œãã‚Œã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
ãã‚Œãã‚Œã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚³ãƒãƒ³ãƒ‰ã§ã™ã€‚å¿…è¦ã«å¿œã˜ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å®Ÿæ–½ã—ã¦ãã ã•ã„ã€‚
```
$ go install golang.org/x/tools/cmd/goimports@latest
$ go install github.com/kisielk/errcheck@latest
$ go install honnef.co/go/tools/cmd/staticcheck@latest
$ brew install golangci-lint
$ brew upgrade golangci-lint
$ curl -sfL https://raw.githubusercontent.com/securego/gosec/master/install.sh | sh -s -- -b $(GOPATH)/bin latest
```

makeã‚³ãƒãƒ³ãƒ‰ã«ã—ã¦ã‚ã‚‹ã®ã§ã€ä¸€æ‹¬ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚‚å¯èƒ½ã§ã™ã€‚
```
$ cd utils/file
$ make install
```


### makeã‚³ãƒãƒ³ãƒ‰ã§precommitä¸€æ‹¬å®Ÿè¡Œ
GitHubã¸pushã™ã‚‹å‰ã«makeã‚³ãƒãƒ³ãƒ‰ã§ä¸‹è¨˜precommitã‚’ä¸€æ‹¬å®Ÿæ–½ã—ã¾ã™ã€‚hookã—ã¦è‡ªå‹•ã§precommitã‚’ã‹ã‘ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ãŒã€Draft PRãªã©ã§ã¨ã‚Šã‚ãˆãšã®pushã—ãŸã„ã“ã¨ã‚‚ã‚ã‚Šã€ãƒãƒ‹ãƒ¥ã‚¢ãƒ«é‹ç”¨ã¨ã—ã¦ã„ã¾ã™ï¼ˆè‡ªå‹•åŒ–ã¯GitHubå´ã®reviewdogãªã©å°å…¥äºˆå®šï¼‰ã€‚

ä»¥ä¸‹ãŒMakefileã®å®šç¾©ã¨ãªã‚Šã¾ã™ã€‚
```makefile:utils/file/Makefile
# precommit check
precommit: goimports fmt errcheck staticcheck gosec

goimports:
	find . -print | grep --regex '.*\.go' | xargs goimports -w -local "github.com/hirac1220/go-file/utils"

fmt:
	go fmt ./...

vet:
	go vet ./...

errcheck:
	errcheck

staticcheck:
	staticcheck ./...

golangci:
	golangci-lint run ./...

gosec:
	gosec ./...
```

### precommitå®Ÿè¡Œçµæœ

ä»¥ä¸‹makeã‚³ãƒãƒ³ãƒ‰ã§å®Ÿè¡Œã—ã¾ã™ã€‚
```
$ cd utils/file
$ make precommit
```

precommitå®Ÿè¡Œçµæœã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```
$ make precommit
find . -print | grep --regex '.*\.go' | xargs goimports -w -local "github.com/hirac1220/go-file/utils"
go fmt ./...
errcheck
staticcheck ./...
gosec ./...
[gosec] 2022/03/21 18:32:15 Including rules: default
[gosec] 2022/03/21 18:32:15 Excluding rules: default
[gosec] 2022/03/21 18:32:15 Import directory: /Users/kimi/go/src/github.com/hirac1220/go/go-file-validate/utils/file
[gosec] 2022/03/21 18:32:16 Checking package: file
[gosec] 2022/03/21 18:32:16 Checking file: /Users/kimi/go/src/github.com/hirac1220/go/go-file-validate/utils/file/file.go
Results:


Summary:
  Gosec  : 2.9.3
  Files  : 1
  Lines  : 66
  Nosec  : 0
  Issues : 0

```

### PRæ™‚ã®precommit checkãƒªã‚¹ãƒˆ
ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ä½œæˆã—ã€PRæ™‚ã«precommitå®Ÿæ–½ã—ãŸã‹ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚
æ·»ä»˜ã®ã‚ˆã†ã«ã€ãƒªãƒã‚¸ãƒˆãƒªã®create new fileã§.github/pull_request_template.mdã‚’ä½œæˆã—ã€ä»¥ä¸‹ã‚’è¨˜å…¥ã—ã¾ã™ã€‚

```
### ãƒ¬ãƒ“ãƒ¥ãƒ¼å‰ãƒã‚§ãƒƒã‚¯
- [ ] make precommit

```

![](/images/4174823c5628b9/pr_template.png)

https://docs.github.com/ja/communities/using-templates-to-encourage-useful-issues-and-pull-requests/creating-a-pull-request-template-for-your-repository

PRå®Ÿæ–½ã™ã‚‹ã¨æ·»ä»˜ã®ã‚ˆã†ã«precommitãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
![](/images/4174823c5628b9/pr_check.png)

### ã¾ã¨ã‚
ä»Šå›ã¯Goè¨€èªã§ã®GitHubãªã©ã¸pushã™ã‚‹å‰ã«makeã‚³ãƒãƒ³ãƒ‰ã§precommitã‚’ã™ã‚‹æ–¹æ³•ã‚’è§£èª¬ã—ã¾ã—ãŸã€‚ä»Šå¾Œã¯precommitã¨åŒç­‰ã®è¨­å®šã‚’ã—ãŸreviewdogãªã©å°å…¥ã—ã€precommitã›ãšã«PRã™ã‚‹ã¨è‡ªå‹•ã§ã‚³ãƒ¡ãƒ³ãƒˆã—ã¦ã‚‚ã‚‰ã†ã‚ˆã†ã«ã—ã¦ã„ããŸã„ã§ã™ã€‚

https://github.com/reviewdog/reviewdog

ä»Šå›ä½¿ç”¨ã—ãŸã‚µãƒ³ãƒ—ãƒ«ã¯ã“ã¡ã‚‰ã®GitHubãƒ¬ãƒã‚¸ãƒˆãƒªã«ã‚ã‚Šã¾ã™ã€‚
https://github.com/hirac1220/go-file-validate

å¼Šç¤¾ã§ã¯ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ»ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ»CoreAIæ©Ÿèƒ½é–‹ç™ºã®ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã‚’ç©æ¥µçš„ã«æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚ã”èˆˆå‘³ã®ã‚ã‚‹æ–¹ã¯ä¸‹è¨˜ãƒªãƒ³ã‚¯ã‚ˆã‚Šã”å¿œå‹ŸãŠå¾…ã¡ã—ã¦ãŠã‚Šã¾ã™ï¼
https://www.wantedly.com/companies/sweeep/projects

ã¾ãŸã¯ã€ã¾ãšã¯ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«ã«ãŠè©±ã—ã¦ã¿ãŸã„ã€ã¨ã„ã†æ–¹ã¯ä¸‹è¨˜ãƒªãƒ³ã‚¯ã‚ˆã‚ŠãŠç”³ã—è¾¼ã¿ãã ã•ã„ï¼
https://meety.net/matches/rrjHPEVHXDiW